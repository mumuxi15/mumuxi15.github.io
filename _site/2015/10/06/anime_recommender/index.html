<!DOCTYPE html>
<html>

  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>Anime Recommender</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="Hi, my name is Penny Pan, a New York based data scientist with passion for machine learning
">
    <link rel="canonical" href="http://localhost:4000/penny-pan/2015/10/06/anime_recommender/">
    <link rel="shortcut icon" href="/assets/favicon.ico" type="image/x-icon">
    <link rel="icon" href="/assets/favicon.ico" type="image/x-icon">

    <!-- Custom CSS -->
    <link rel="stylesheet" href="/penny-pan/css/main.css">
</head>


  <body>

    <main class="wrapper">
      
      <header class="site-header">
  <a class="site-title" href="/penny-pan/"><img src="https://unsplash.it/500/150"></a>
    
  <nav class="navbar">
    <ul>
      <li class="nav-item"><a href="/penny-pan/">home</a></li>
      <li class="nav-item"><a href="/penny-pan/about/">about</a></li>
    </ul>
  </nav>

</header>


      <div class="container">
        <div class="post">
  <div class="post-nav">
    
    
  </div>

  <header class="post-header">
    <h1 class="post-title">Anime Recommender</h1>
  </header>

  <article class="post-content">
    <h4 id="data">Data</h4>

<hr />

<p>I scraped 9000 anime descriptions and 5000 user profiles from myAnimeList and stored as BSON object in the MongoDB. After combining specials and series, I obtained 4588 animes descriptions in total. Data was stored as anime description and user watched history seperately in MongoDB .</p>

<p>e.g Anime description</p>

<div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">{</span><span class="err">'_id'</span><span class="p">:</span><span class="w"> </span><span class="err">'Yaiba'</span><span class="p">,</span><span class="w">
 </span><span class="err">'themesongs'</span><span class="p">:</span><span class="w"> </span><span class="p">[[</span><span class="err">'</span><span class="s2">"Yuuki ga Areba (勇気があれば)"</span><span class="w"> </span><span class="err">by</span><span class="w"> </span><span class="err">Kabuki</span><span class="w"> </span><span class="err">Rocks</span><span class="w"> </span><span class="err">(カブキロックス)'</span><span class="p">,</span><span class="w">
   </span><span class="err">'</span><span class="s2">"Shinchigakunaki Tatakai! (神智学無き戦い!)"</span><span class="w"> </span><span class="err">by</span><span class="w"> </span><span class="err">Kabuki</span><span class="w"> </span><span class="err">Rocks</span><span class="w"> </span><span class="err">(カブキロックス)'</span><span class="p">]],</span><span class="w">
 </span><span class="err">'description'</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="s2">"Kurogane Yaiba is a boy who doesn't want to become what any regular kid would: A samurai. That's why he undergoes a hard training with his father, knowing only the forest as his world. Then, one day, he is sent to Japan, where he has to deal with a whole new civilized reality, meeting the Mine family, the evil Onimaru and even the legendary Musashi, having lots of dangerous adventures, becoming stronger everyday.(Source: ANN, edited) "</span><span class="p">],</span><span class="w">
 </span><span class="err">'reviews'</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="err">'which</span><span class="w"> </span><span class="err">are</span><span class="w"> </span><span class="err">really</span><span class="w"> </span><span class="err">stupid</span><span class="w"> </span><span class="err">but</span><span class="w"> </span><span class="err">it</span><span class="w"> </span><span class="err">all</span><span class="w"> </span><span class="err">succeds</span><span class="w"> </span><span class="err">in</span><span class="w"> </span><span class="err">tickling</span><span class="w"> </span><span class="err">us!!the</span><span class="w"> </span><span class="err">storycharacter</span><span class="w"> </span><span class="err">and</span><span class="w"> </span><span class="err">enjoyment</span><span class="w"> </span><span class="err">is</span><span class="w"> </span><span class="err">quite</span><span class="w"> </span><span class="err">okwell</span><span class="w"> </span><span class="err">i</span><span class="w"> </span><span class="err">personally</span><span class="w"> </span><span class="err">disliked</span><span class="w"> </span><span class="err">the</span><span class="w"> </span><span class="err">op</span><span class="w"> </span><span class="err">and</span><span class="w"> </span><span class="err">ed</span><span class="w"> </span><span class="err">and</span><span class="w"> </span><span class="err">art</span><span class="w"> </span><span class="err">also</span><span class="w"> </span><span class="err">seems</span><span class="w"> </span><span class="err">quite</span><span class="w"> </span><span class="err">ok</span><span class="w"> </span><span class="p">{</span><span class="err">not</span><span class="w"> </span><span class="err">many</span><span class="w"> </span><span class="err">cute</span><span class="w"> </span><span class="err">girls</span><span class="w"> </span><span class="p">:</span><span class="err">(</span><span class="w"> </span><span class="p">}</span><span class="err">its</span><span class="w"> </span><span class="err">a</span><span class="w"> </span><span class="err">lot</span><span class="w"> </span><span class="err">of</span><span class="w"> </span><span class="err">fun</span><span class="w"> </span><span class="err">overall</span><span class="w"> </span><span class="err">the</span><span class="w"> </span><span class="err">series</span><span class="w"> </span><span class="err">i</span><span class="w"> </span><span class="err">ll</span><span class="w"> </span><span class="err">definately</span><span class="w"> </span><span class="err">say</span><span class="w"> </span><span class="err">give</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="err">shot</span><span class="w"> </span><span class="err">only</span><span class="w"> </span><span class="err">to</span><span class="w"> </span><span class="err">the</span><span class="w"> </span><span class="mi">1</span><span class="err">st</span><span class="w"> </span><span class="err">epi!!!ull</span><span class="w"> </span><span class="err">automatically</span><span class="w"> </span><span class="err">get</span><span class="w"> </span><span class="err">hooked</span><span class="w"> </span><span class="err">to</span><span class="w"> </span><span class="err">the</span><span class="w"> </span><span class="err">series</span><span class="w"> </span><span class="err">atleast</span><span class="w"> </span><span class="err">i</span><span class="w"> </span><span class="err">did</span><span class="w"> </span><span class="err">!well</span><span class="w"> </span><span class="err">i</span><span class="w"> </span><span class="err">hope</span><span class="w"> </span><span class="err">u</span><span class="w"> </span><span class="err">liked</span><span class="w"> </span><span class="err">my</span><span class="w"> </span><span class="err">review</span><span class="w"> </span><span class="err">plz</span><span class="w"> </span><span class="err">ratemy</span><span class="w"> </span><span class="mi">1</span><span class="err">st</span><span class="w"> </span><span class="err">reviewread</span><span class="w"> </span><span class="err">more'</span><span class="p">],</span><span class="w">
 </span><span class="err">'img_url'</span><span class="p">:</span><span class="w"> </span><span class="err">'https</span><span class="p">:</span><span class="err">//myanimelist.cdn-dena.com/images/anime/</span><span class="mi">5</span><span class="err">/</span><span class="mi">71953</span><span class="err">.jpg'</span><span class="p">}</span><span class="w">
</span></code></pre></div></div>

<p>e.g. User watched history. Table shows anime ratings of 5 animes given by 5 different users. Rating system is from 1-10.</p>

<table>
  <thead>
    <tr>
      <th>Anime/score</th>
      <th>User1</th>
      <th>User2</th>
      <th>User3</th>
      <th>User4</th>
      <th>User5</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>Fairy Tail</td>
      <td>10</td>
      <td>8</td>
      <td>10</td>
      <td>5</td>
      <td>?</td>
    </tr>
    <tr>
      <td>Kimi no na wa</td>
      <td>10</td>
      <td>9</td>
      <td>?</td>
      <td>?</td>
      <td>4</td>
    </tr>
    <tr>
      <td>No game no life</td>
      <td>9</td>
      <td>?</td>
      <td>9</td>
      <td>?</td>
      <td>?</td>
    </tr>
    <tr>
      <td>Tokyo Ghoul</td>
      <td>7</td>
      <td>?</td>
      <td>9</td>
      <td>?</td>
      <td>?</td>
    </tr>
    <tr>
      <td>One Piece</td>
      <td>?</td>
      <td>?</td>
      <td>?</td>
      <td>10</td>
      <td>9</td>
    </tr>
  </tbody>
</table>

<h4 id="how-does--recommender-system-works-">How does  recommender system works ?</h4>

<hr />

<p>Broadly speaking, there are two common algorithms used in recommendation system, collaborative filtering and content-Based Filtering. Collaborative filtering predicts based on past user behavior and the idea is to use opinions from other users with similar taste. Content-Based Filtering, like the name suggested, it is based on a comparison between item descriptions and a user profile.</p>

<p>Let’s consider converting the rating score table above to a matrix called <strong>R<sub>rating</sub></strong> , this matrix holds all ratings from all users for all movies (10000 movies x 5000 users). Each column represents rating scores from a user, and we replace ? with 0.  ? means movies has not watched.</p>

<pre><code class="language-mathematica">[[ 10  8   10  5   0]
 [ 10  9   0   0   4]
 [ 9   0   9   0   0]
 [ 7   0   9   0   0]
 [ 0   0   0   10  9]]
</code></pre>

<p>When recommending from a large selection (which is in this case), users only have rated a few out of thousands of selections and the result will be a large sparse matrix where elements are mostly zero. Simple recommender will not be good due to sparsity probelem. So how do we handel sparse matrices?</p>

<p>The answer is a hybrid recommender system. In case of sparsity, a hybrid approach can be more effetive by combining collaborative filtering and content-based filtering. Collaborative filtering offers more interesting and diversed recommendations but suffers from cold start problem. By combining the two, It will also help to overcome the cold start problem.</p>

<p><strong>My recommender = Collaborative filtering + Content based filtering</strong></p>

<p><img src="https://i.imgur.com/zBbWj8p.jpg" /></p>

<p><strong>Recommender1 workflow</strong></p>

<p>For recommender1, a user’s predicted rating for an anime would equal the dot product of the user’s and anime’s features.</p>

<p><strong>R<sub>rating</sub> = P x <sup>Q</sup></strong></p>

<p>where P and Q are matrices that minimizes the regularized squared error.  P represents the strength of the associations between users and the features. Similarly, Q represents the strength of the associations between animes and the features. Therefore, recommender1 generates recommendations by calculating similarity between P and Q.</p>

<p><strong>Recommender2 workflow</strong></p>

<p>30 topics were extracted from anime descriptions. Each anime will have an associated probability for each topic.  For example</p>

<table>
  <thead>
    <tr>
      <th>Anime/Topics</th>
      <th>War</th>
      <th>School</th>
      <th>Robot</th>
      <th>Demon</th>
      <th>Game</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>Fairy Tail</td>
      <td>0.27</td>
      <td>0.02</td>
      <td>0.00</td>
      <td>0.59</td>
      <td>0.11</td>
    </tr>
    <tr>
      <td>Kimi no na wa</td>
      <td>0.01</td>
      <td>0.95</td>
      <td>0.00</td>
      <td>0.01</td>
      <td>0.01</td>
    </tr>
    <tr>
      <td>No game no life</td>
      <td>0.35</td>
      <td>0.01</td>
      <td>0.00</td>
      <td>0.01</td>
      <td>0.63</td>
    </tr>
    <tr>
      <td>Tokyo Ghoul</td>
      <td>0.01</td>
      <td>0.15</td>
      <td>0.01</td>
      <td>0.12</td>
      <td>0.08</td>
    </tr>
    <tr>
      <td>One Piece</td>
      <td>0.28</td>
      <td>0.00</td>
      <td>0.00</td>
      <td>0.45</td>
      <td>0.01</td>
    </tr>
  </tbody>
</table>

<p>By averaging all user’s past watched anime topics, we can get user’s preference on topic. Then we can calculate cosine similarity between user topic matrices and anime topic matrice to generate recommendations.</p>

<ol>
  <li>Topic Modelling</li>
</ol>

<ul>
  <li>
    <ul>
      <li>Feature_extraction using TF-IDF</li>
      <li>Decomposition techniques using NMF</li>
    </ul>
  </li>
</ul>

<p>NLP stands for Natural Language Processing, it is defined as the computational technique to understand and manipulate human language and speech. Here we are going to demostrate how we can extract topics from anime descriptions with help of NLP.</p>

<p>Two challenges of this project.</p>

<ol>
  <li>
    <p>words have different forms</p>
  </li>
  <li>
    <p>A lot of anime terms appeared frequently.</p>
  </li>
</ol>

<p>Solutions to solve NLP challenges:</p>

<ul>
  <li>Preprocess words with stemming and lemmatizing techinque to reduce different forms of a word. For example, beautiful -&gt; beauty, cars -&gt; car</li>
  <li>TF-IDF (Term Frequency–Inverse Document Frequency)</li>
</ul>

<p><img src="https://cdn-images-1.medium.com/max/1600/0*WcQ96JVrKLlC4cZN.jpg" /></p>

<p>Please wait for the update, ….</p>

<p>Conclusion:</p>

<p>The important factors of a good recommender: diversity, privacy, robustness, serendipity, labelling.</p>

  </article>

</div>


        <footer class="site-footer">
  <h2 class="footer-heading">Penny's blog</h2>

  <div class="row">
    <div class="column">
      <ul class="contact-list">
        <li>Penny's blog</li>
        <li><a href="mailto:mumuxi15@gmail.com">mumuxi15@gmail.com</a></li>
      </ul>
    </div>

    <div class="column">
      <ul class="social-media-list">
        
        <li>
          <a href="https://github.com/mumuxi15">
            <span class="icon  icon--github">
              <svg viewBox="0 0 16 16">
                <path fill="#828282" d="M7.999,0.431c-4.285,0-7.76,3.474-7.76,7.761 c0,3.428,2.223,6.337,5.307,7.363c0.388,0.071,0.53-0.168,0.53-0.374c0-0.184-0.007-0.672-0.01-1.32 c-2.159,0.469-2.614-1.04-2.614-1.04c-0.353-0.896-0.862-1.135-0.862-1.135c-0.705-0.481,0.053-0.472,0.053-0.472 c0.779,0.055,1.189,0.8,1.189,0.8c0.692,1.186,1.816,0.843,2.258,0.645c0.071-0.502,0.271-0.843,0.493-1.037 C4.86,11.425,3.049,10.76,3.049,7.786c0-0.847,0.302-1.54,0.799-2.082C3.768,5.507,3.501,4.718,3.924,3.65 c0,0,0.652-0.209,2.134,0.796C6.677,4.273,7.34,4.187,8,4.184c0.659,0.003,1.323,0.089,1.943,0.261 c1.482-1.004,2.132-0.796,2.132-0.796c0.423,1.068,0.157,1.857,0.077,2.054c0.497,0.542,0.798,1.235,0.798,2.082 c0,2.981-1.814,3.637-3.543,3.829c0.279,0.24,0.527,0.713,0.527,1.437c0,1.037-0.01,1.874-0.01,2.129 c0,0.208,0.14,0.449,0.534,0.373c3.081-1.028,5.302-3.935,5.302-7.362C15.76,3.906,12.285,0.431,7.999,0.431z"/>
              </svg>
            </span>

            <span class="username">mumuxi15</span>
          </a>
        </li>
        

        
        <li>
          <a href="https://twitter.com/jekyllrb">
            <span class="icon  icon--twitter">
              <svg viewBox="0 0 16 16">
                <path fill="#828282" d="M15.969,3.058c-0.586,0.26-1.217,0.436-1.878,0.515c0.675-0.405,1.194-1.045,1.438-1.809
                c-0.632,0.375-1.332,0.647-2.076,0.793c-0.596-0.636-1.446-1.033-2.387-1.033c-1.806,0-3.27,1.464-3.27,3.27 c0,0.256,0.029,0.506,0.085,0.745C5.163,5.404,2.753,4.102,1.14,2.124C0.859,2.607,0.698,3.168,0.698,3.767 c0,1.134,0.577,2.135,1.455,2.722C1.616,6.472,1.112,6.325,0.671,6.08c0,0.014,0,0.027,0,0.041c0,1.584,1.127,2.906,2.623,3.206 C3.02,9.402,2.731,9.442,2.433,9.442c-0.211,0-0.416-0.021-0.615-0.059c0.416,1.299,1.624,2.245,3.055,2.271 c-1.119,0.877-2.529,1.4-4.061,1.4c-0.264,0-0.524-0.015-0.78-0.046c1.447,0.928,3.166,1.469,5.013,1.469 c6.015,0,9.304-4.983,9.304-9.304c0-0.142-0.003-0.283-0.009-0.423C14.976,4.29,15.531,3.714,15.969,3.058z"/>
              </svg>
            </span>

            <span class="username">jekyllrb</span>
          </a>
        </li>
        
      </ul>
    </div>

    <div class="column">
      <p>Hi, my name is Penny Pan, a New York based data scientist with passion for machine learning
</p>
    </div>
  </div>

</footer>

      </div>
    
    </main>
    
  </body>

</html>
